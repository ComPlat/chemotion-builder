Sending build context to Docker daemon  944.8MB
Step 1/87 : ARG BASE=chemotion-build/base:1.4.0
Step 2/87 : ARG CHEMOTION_BUILD_TAG=67d363fa018ff448e0c83919c3e07535022e4978
Step 3/87 : ARG CHEMOTION_RELEASE=1.4.0p221001
Step 4/87 : ARG CHEMOTION_VERSION=1.4.0
Step 5/87 : ARG BUILDRUN
Step 6/87 : ARG RUBY_VERSION=latest:2.6
Step 7/87 : ARG NODE_VERSION=14.20.0
Step 8/87 : ARG BUNDLER_VERSION=1.17.3
Step 9/87 : ARG ASDF_VERSION=v0.10.2
Step 10/87 : ARG PANDOC_VERSION=2.10.1
Step 11/87 : ARG BUILD_PATH=/builder
Step 12/87 : ARG PORT=4000
Step 13/87 : FROM ${BASE} as eln-ruby-node
 ---> ddd79c08c9e5
Step 14/87 : RUN apt-get install -y --no-install-recommends git ca-certificates curl
 ---> Using cache
 ---> a55b046f9f8a
Step 15/87 : ARG BUILD_PATH
 ---> Using cache
 ---> cc2000dab1ae
Step 16/87 : ARG ASDF_VERSION
 ---> Using cache
 ---> 767274661c75
Step 17/87 : ARG RUBY_VERSION
 ---> Using cache
 ---> 8ce8c920784f
Step 18/87 : ARG NODE_VERSION
 ---> Using cache
 ---> 9460f955b5b5
Step 19/87 : ARG BUNDLER_VERSION
 ---> Using cache
 ---> ee5876e8b28d
Step 20/87 : ENV ASDF_DIR=/asdf                                          ASDF_DATA_DIR=/asdf                                     ASDF_DEFAULT_TOOL_VERSIONS_FILENAME=.tool-versions      GEM_HOME=${BUILD_PATH}/cache/gems
 ---> Using cache
 ---> f9b49ec5377b
Step 21/87 : ENV PATH="${GEM_HOME}/bin:${GEM_HOME}/gems/bin:${ASDF_DIR}/shims:${ASDF_DIR}/bin:${PATH}"
 ---> Using cache
 ---> 6e1410a21782
Step 22/87 : RUN apt-get install -y --no-install-recommends build-essential     `# for asdf: ruby`     zlib1g-dev libssl-dev libreadline-dev
 ---> Using cache
 ---> fa52cb0e9583
Step 23/87 : RUN git clone https://github.com/asdf-vm/asdf.git /asdf --branch "${ASDF_VERSION}"
 ---> Using cache
 ---> ed4aea503ed9
Step 24/87 : RUN asdf plugin add nodejs https://github.com/asdf-vm/asdf-nodejs.git &&     asdf install nodejs "${NODE_VERSION}" &&     asdf global nodejs "${NODE_VERSION}" &&     npm install -g yarn
 ---> Using cache
 ---> 191cedeb8c7d
Step 25/87 : RUN asdf plugin add ruby https://github.com/asdf-vm/asdf-ruby.git &&     asdf install ruby "${RUBY_VERSION}" &&     asdf global ruby "${RUBY_VERSION}" &&     gem install bundler -v "${BUNDLER_VERSION}"
 ---> Using cache
 ---> 18db435d6d1d
Step 26/87 : FROM "${BASE}" as eln-runtimes
 ---> ddd79c08c9e5
Step 27/87 : RUN apt-get install -y --no-install-recommends git ca-certificates curl
 ---> Using cache
 ---> a55b046f9f8a
Step 28/87 : ARG BUILD_PATH
 ---> Using cache
 ---> cc2000dab1ae
Step 29/87 : COPY --from=eln-ruby-node /asdf /asdf
 ---> Using cache
 ---> 5ee2d5bb2fa2
Step 30/87 : COPY --from=eln-ruby-node /root/.tool-versions /root/.tool-versions
 ---> Using cache
 ---> c4908f92dee8
Step 31/87 : COPY --from=eln-ruby-node ${BUILD_PATH} ${BUILD_PATH}
 ---> Using cache
 ---> d0cb7b365246
Step 32/87 : ENV ASDF_DIR=/asdf          ASDF_DATA_DIR=/asdf     ASDF_DEFAULT_TOOL_VERSIONS_FILENAME=.tool-versions     GEM_HOME=${BUILD_PATH}/cache/gems
 ---> Using cache
 ---> a3d93f08bdf3
Step 33/87 : ENV PATH="${GEM_HOME}/bin:${GEM_HOME}/gems/bin:${ASDF_DIR}/shims:${ASDF_DIR}/bin:${PATH}"
 ---> Using cache
 ---> 49815a6cc45e
Step 34/87 : RUN asdf --version  &&     asdf list       &&     node -v         &&     npm -v          &&     npx -v          &&     yarn -v         &&     ruby -v         &&     gem -v          &&     bundle -v
 ---> Using cache
 ---> b855c06673e9
Step 35/87 : SHELL ["/bin/bash", "-e", "-o", "pipefail", "-c", "--"]
 ---> Using cache
 ---> a22b4fc94391
Step 36/87 : ARG CHEMOTION_RELEASE
 ---> Using cache
 ---> bcca283f2fae
Step 37/87 : ARG CHEMOTION_VERSION
 ---> Using cache
 ---> 3293cf193444
Step 38/87 : ARG CHEMOTION_BUILD_TAG
 ---> Using cache
 ---> 033a9d542a6b
Step 39/87 : ARG PANDOC_VERSION
 ---> Using cache
 ---> 9439e7783adb
Step 40/87 : RUN apt-get install -y --no-install-recommends build-essential     `# for the gems`     cmake libpq-dev swig     libboost-serialization-dev     libboost-iostreams-dev     libboost-system-dev     libeigen3-dev     libmagickcore-dev     python3-dev libsqlite3-dev
 ---> Using cache
 ---> e89a7941e18d
Step 41/87 : RUN mkdir -p ${BUILD_PATH}/tmp     && curl -L -o ${BUILD_PATH}/tmp/pandoc.deb "https://github.com/jgm/pandoc/releases/download/${PANDOC_VERSION}/pandoc-${PANDOC_VERSION}-1-amd64.deb" &&     mkdir -p ${BUILD_PATH}/usr/bin && curl -L -o ${BUILD_PATH}/usr/bin/yq     "https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64" && chmod +x ${BUILD_PATH}/usr/bin/yq
 ---> Using cache
 ---> 47191f8b3cd5
Step 42/87 : RUN [ -n "${CHEMOTION_BUILD_TAG}" ] && echo "CHECKOUT: ${CHEMOTION_BUILD_TAG}" &&     git init --initial-branch=main ${BUILD_PATH}/chemotion/app &&     git -C ${BUILD_PATH}/chemotion/app remote add origin https://github.com/ComPlat/chemotion_ELN &&     git -C ${BUILD_PATH}/chemotion/app fetch --tags --depth 1 origin "${CHEMOTION_BUILD_TAG}" &&     git -C ${BUILD_PATH}/chemotion/app reset --hard FETCH_HEAD &&     git -C ${BUILD_PATH}/chemotion/app describe --abbrev=0 --tags || echo ${CHEMOTION_BUILD_TAG} &&     cat ${BUILD_PATH}/chemotion/app/VERSION
 ---> Using cache
 ---> d17de0d24949
Step 43/87 : WORKDIR ${BUILD_PATH}/chemotion/app
 ---> Using cache
 ---> 130300fac7ff
Step 44/87 : RUN echo "CHEMOTION_REF=$(git rev-parse --short HEAD || echo unknown)" >> ${BUILD_PATH}/chemotion/app/.version      &&     echo "CHEMOTION_TAG=$(git describe --abbrev=0 --tags || echo untagged)" >> ${BUILD_PATH}/chemotion/app/.version &&     echo "RELEASE=${CHEMOTION_RELEASE}" >> ${BUILD_PATH}/chemotion/app/.version                                     &&     echo "VERSION=${CHEMOTION_VERSION}" >> ${BUILD_PATH}/chemotion/app/.version                                     &&     cat ${BUILD_PATH}/chemotion/app/.version
 ---> Using cache
 ---> cdb4ce9edc78
Step 45/87 : RUN asdf --version  &&     asdf list       &&     node -v         &&     npm -v          &&     npx -v          &&     yarn -v         &&     ruby -v         &&     gem -v          &&     bundle -v       &&     cat ${BUILD_PATH}/chemotion/app/VERSION &&     cat ${BUILD_PATH}/chemotion/app/.version &&     test -f ${BUILD_PATH}/usr/bin/yq &&     test -f ${BUILD_PATH}/tmp/pandoc.deb
 ---> Using cache
 ---> e3d2037abe61
Step 46/87 : RUN find ./config -type f -name '*.yml.example' -print | while read -r f; do     echo "$f to ${f%.example}";     ${BUILD_PATH}/usr/bin/yq -ojson < "$f" |     ${BUILD_PATH}/usr/bin/yq -oyaml -P 'with(select(.production != null); . = {"production":.production}) | with(select(.production == null); {})' > "${f%.example}";     done
 ---> Using cache
 ---> 313e4aa8bc2a
Step 47/87 : RUN rm -f config/deploy.rb     config/environments/development.rb     config/environments/test.rb     ./**/*.example     ./**/*github*     ./**/*gitlab*     ./**/*travis*     ./**/*.bak        ./**/*git* || true
 ---> Using cache
 ---> 9a8eb823386d
Step 48/87 : RUN if [ -f ${BUILD_PATH}/chemotion/app/public/favicon.ico ] && [ ! -e ${BUILD_PATH}/chemotion/app/public/favicon.ico.example ]; then     cp ${BUILD_PATH}/chemotion/app/public/favicon.ico ${BUILD_PATH}/chemotion/app/public/favicon.ico.example;     fi
 ---> Using cache
 ---> 4668959c2b7a
Step 49/87 : COPY ./additives/chemotion/ ${BUILD_PATH}/chemotion/app
 ---> Using cache
 ---> 4234416d0f1a
Step 50/87 : RUN mkdir -p ${BUILD_PATH}/chemotion/data &&     mv ${BUILD_PATH}/chemotion/app/uploads ${BUILD_PATH}/chemotion/data/ || mkdir -p ${BUILD_PATH}/chemotion/data/uploads &&     ln -s /chemotion/data/uploads/ ${BUILD_PATH}/chemotion/app/uploads &&     test "$(readlink ${BUILD_PATH}/chemotion/app/uploads)" == "/chemotion/data/uploads/" &&     test -d ${BUILD_PATH}/chemotion/data/uploads
 ---> Using cache
 ---> 4577085fd46f
Step 51/87 : RUN mkdir -p ${BUILD_PATH}/chemotion/data/public/ &&     mv ${BUILD_PATH}/chemotion/app/public/images/ ${BUILD_PATH}/chemotion/data/public/ || mkdir -p ${BUILD_PATH}/chemotion/data/public/images &&     ln -s /chemotion/data/public/images/ ${BUILD_PATH}/chemotion/app/public/images &&     test "$(readlink ${BUILD_PATH}/chemotion/app/public/images)" == "/chemotion/data/public/images/" &&     test -d ${BUILD_PATH}/chemotion/data/public/images
 ---> Using cache
 ---> 309963f5ff9c
Step 52/87 : ADD ./cache/bundle.tar.gz           /cache/
 ---> Using cache
 ---> e8c33cafa424
Step 53/87 : ADD ./cache/gems.tar.gz             ${BUILD_PATH}/cache/
 ---> Using cache
 ---> 03c4ed74c0f9
Step 54/87 : ADD ./cache/node-modules.tar.gz     ${BUILD_PATH}/chemotion/app/
 ---> Using cache
 ---> 3d63b90d92c2
Step 55/87 : RUN asdf --version  &&     asdf list       &&     node -v         &&     npm -v          &&     npx -v          &&     yarn -v         &&     ruby -v         &&     gem -v          &&     bundle -v       &&     cat /builder/chemotion/app/VERSION &&     cat /builder/chemotion/app/.version &&     test -f /builder/usr/bin/yq &&     test -f /builder/tmp/pandoc.deb &&     test -L /builder/chemotion/app/public/images &&     test -d /builder/chemotion/data/public/images &&     [[ "$(readlink /builder/chemotion/app/public/images)" == "/chemotion/data/public/images/" ]] &&     test -L /builder/chemotion/app/uploads &&     test -d /builder/chemotion/data/uploads &&     [[ "$(readlink /builder/chemotion/app/uploads)" == "/chemotion/data/uploads/" ]]
 ---> Using cache
 ---> a273dcc7fff7
Step 56/87 : ENV BUNDLE_PATH=/cache/bundle                               BUNDLE_USER_HOME=/cache/bundle                          BUNDLE_CACHE_ALL=1                                      RAILS_ENV=production                                    RAKE_ENV=production                                     NODE_ENV=production                                     NODE_OPTIONS=--max_old_space_size=4096                  THOR_SILENCE_DEPRECATION=1
 ---> Using cache
 ---> 1668c4bed4ca
Step 57/87 : RUN MAKEFLAGS="-j$(getconf _NPROCESSORS_ONLN)" && export MAKEFLAGS &&     bundle config --global silence_root_warning 1 &&     bundle install --jobs="$(getconf _NPROCESSORS_ONLN)" --retry=3 --standalone production --without development test
 ---> Using cache
 ---> c9edb3bc8096
Step 58/87 : RUN MAKEFLAGS="-j$(getconf _NPROCESSORS_ONLN)" && export MAKEFLAGS &&     yarn install --ignore-engines 2>&1 | grep -v ^warning
 ---> Using cache
 ---> 4110ebbd9837
Step 59/87 : FROM "${BASE}" as eln-builder
 ---> ddd79c08c9e5
Step 60/87 : RUN apt-get install -y --no-install-recommends git ca-certificates curl
 ---> Using cache
 ---> a55b046f9f8a
Step 61/87 : RUN apt-get install -y --no-install-recommends --autoremove --fix-missing     `# for chemotion`     libboost-serialization1.74.0     libboost-iostreams1.74.0     postgresql-client `# also adds pg_isready`     inkscape `# this installs python3`     imagemagick     locales     `# utilitites`     vim iproute2 sudo make patchelf
 ---> Using cache
 ---> 9b02f416ced4
Step 62/87 : COPY --from=eln-runtimes /asdf /asdf
 ---> Using cache
 ---> 900315677545
Step 63/87 : COPY --from=eln-runtimes /root/.tool-versions /root/.tool-versions
 ---> Using cache
 ---> 4732d17b84ea
Step 64/87 : COPY --from=eln-runtimes /builder /
 ---> Using cache
 ---> e95d6b4343c1
Step 65/87 : COPY --from=eln-runtimes /cache /cache
 ---> Using cache
 ---> 83020eb65706
Step 66/87 : ENV ASDF_DIR=/asdf                                          ASDF_DATA_DIR=/asdf                                     ASDF_DEFAULT_TOOL_VERSIONS_FILENAME=.tool-versions      BUNDLE_PATH=/cache/bundle                               BUNDLE_USER_HOME=/cache/bundle                          BUNDLE_CACHE_ALL=1                                      GEM_HOME=/cache/gems                                    RAILS_ENV=production                                    RAKE_ENV=production                                     NODE_ENV=production                                     NODE_PATH=/chemotion/app/node_modules/                  NODE_OPTIONS=--max_old_space_size=4096                  TERM=xterm-256color                                     THOR_SILENCE_DEPRECATION=1                              RAILS_LOG_TO_STDOUT=1                                   PASSENGER_DOWNLOAD_NATIVE_SUPPORT_BINARY=0              CONFIG_PIDFILE=/chemotion/app/tmp/eln.pid
 ---> Using cache
 ---> 546550f5aecd
Step 67/87 : ENV PATH="${GEM_HOME}/bin:${GEM_HOME}/gems/bin:${ASDF_DIR}/shims:${ASDF_DIR}/bin:${PATH}"
 ---> Using cache
 ---> 1448b1841611
Step 68/87 : SHELL ["/bin/bash", "-e", "-o", "pipefail", "-c", "--"]
 ---> Using cache
 ---> 3f2bf91079a7
Step 69/87 : RUN cat /root/.tool-versions && echo "tool-version file present." &&     test -d /chemotion/app && test -d /chemotion/data && echo "Chemotion directories present." &&     test -d /cache/bundle && test -d /cache/gems &&     test -d /chemotion/app/node_modules/ && echo "Cache directories present." &&     test -f /tmp/pandoc.deb && echo "Pandoc deb present."
 ---> Using cache
 ---> d7d45b89a9a0
Step 70/87 : RUN asdf --version  &&     asdf list       &&     node -v         &&     npm -v          &&     npx -v          &&     yarn -v         &&     ruby -v         &&     gem -v          &&     bundle -v       &&     cat /chemotion/app/VERSION &&     cat /chemotion/app/.version &&     test -L /chemotion/app/public/images &&     test -d /chemotion/data/public/images &&     [[ "$(readlink /chemotion/app/public/images)" == "/chemotion/data/public/images/" ]] &&     test -L /chemotion/app/uploads &&     test -d /chemotion/data/uploads &&     [[ "$(readlink /chemotion/app/uploads)" == "/chemotion/data/uploads/" ]]
 ---> Using cache
 ---> 4587b35428c2
Step 71/87 : COPY ./additives/various/fontfix.conf /etc/fonts/conf.d/99-chemotion-fontfix.conf
 ---> Using cache
 ---> f5e4adb998c6
Step 72/87 : COPY ./additives/embed/               /embed/
 ---> Using cache
 ---> e34ae636a3b2
Step 73/87 : RUN ln -s /embed/bin/chemotion /bin/chemotion &&     cp /chemotion/app/.version /.version &&     cp /chemotion/app/.version /chemotion/data/.version &&     mkdir -p /shared &&     dpkg -i  /tmp/pandoc.deb && rm /tmp/pandoc.deb &&     chmod +x /embed/bin/*
 ---> Using cache
 ---> c1c943bff92d
Step 74/87 : WORKDIR /chemotion/app
 ---> Using cache
 ---> 43edb615c3c8
Step 75/87 : RUN MAKEFLAGS="-j$(getconf _NPROCESSORS_ONLN)" && export MAKEFLAGS &&     bundle config --global silence_root_warning 1 &&     bundle install --jobs="$(getconf _NPROCESSORS_ONLN)" --retry=3
 ---> Using cache
 ---> 564b6a3414cd
Step 76/87 : RUN MAKEFLAGS="-j$(getconf _NPROCESSORS_ONLN)" && export MAKEFLAGS &&     yarn install --ignore-engines 2>&1 | grep -v ^warning &&     yarn cache clean 2>&1 | grep -v ^warning
 ---> Using cache
 ---> 36903105c43f
Step 77/87 : RUN export SECRET_KEY_BASE=build &&     export RAILS_ENV=production &&     [ ! -f ./config/klasses.json ] && echo '[]' > ./config/klasses.json || true &&     rm -f /chemotion/app/public/sprite.png &&     cp "$(bundle show ketcherails)"/app/assets/javascripts/ketcherails/ui/ui.js.erb /tmp/ui.js.bak &&     sed -i 's/Ketcherails::TemplateCategory.with_approved_templates.pluck(:id)/[]/g' "$(bundle show ketcherails)"/app/assets/javascripts/ketcherails/ui/ui.js.erb &&     npx browserslist@latest --update-db 2>&1 | grep -v ^warning &&     bundle exec rake assets:precompile &&     bundle exec rake webpacker:compile &&     mv /tmp/ui.js.bak "$(bundle show ketcherails)"/app/assets/javascripts/ketcherails/ui/ui.js.erb &&     rm -f /chemotion/app/public/sprite.png
 ---> Using cache
 ---> 879750af8e1c
Step 78/87 : RUN asdf --version  &&     asdf list       &&     node -v         &&     npm -v          &&     npx -v          &&     yarn -v         &&     ruby -v         &&     gem -v          &&     bundle -v       &&     (cd /chemotion/app && bundle exec rails -v) &&     cat /chemotion/app/VERSION &&     cat /.version   &&     cat /chemotion/app/.version &&     cat /chemotion/data/.version &&     test -L /chemotion/app/public/images &&     test -d /chemotion/data/public/images &&     [[ "$(readlink /chemotion/app/public/images)" == "/chemotion/data/public/images/" ]] &&     test -L /chemotion/app/uploads &&     test -d /chemotion/data/uploads &&     [[ "$(readlink /chemotion/app/uploads)" == "/chemotion/data/uploads/" ]] &&     test -d /shared &&     test -d /embed &&     test -f /chemotion/app/public/favicon.ico.example &&     test ! -e /chemotion/app/public/sprite.png &&     ls -la /chemotion/data/uploads/ &&     ls -la /chemotion/app/public/images/
 ---> Using cache
 ---> b4e41cfb255d
Step 79/87 : RUN find /root /asdf /cache /chemotion/app/node_modules -iname '*.so' -type f -print0 | xargs -0 ldd | grep -i "not found" || true | sort | uniq
 ---> Using cache
 ---> 8706295a1c12
Step 80/87 : ARG ${PORT}
 ---> Using cache
 ---> 62cd96bc15a7
Step 81/87 : EXPOSE ${PORT}
 ---> Using cache
 ---> 08d6a7933e6a
Step 82/87 : CMD ["/embed/run.sh"]
 ---> Using cache
 ---> 9cbe16f2607d
Step 83/87 : HEALTHCHECK --interval=30s --timeout=3s --start-period=60s --retries=3     CMD /embed/health.sh ${PORT} || exit 1
 ---> Running in 4a1f9099c736
Removing intermediate container 4a1f9099c736
 ---> af2e6309f5b1
Step 84/87 : FROM eln-builder as eln
 ---> af2e6309f5b1
Step 85/87 : ARG CHEMOTION_VERSION
 ---> Running in a6ea9f8a02c1
Removing intermediate container a6ea9f8a02c1
 ---> 4778b1d8b65f
Step 86/87 : ARG BUILDRUN
 ---> Running in c897fea23a16
Removing intermediate container c897fea23a16
 ---> b28adf5b958b
Step 87/87 : LABEL "org.opencontainers.image.authors"="Chemotion Team"     "org.opencontainers.image.title"="Chemotion ELN"     "org.opencontainers.image.description"="Image for Chemotion ELN"     "org.opencontainers.image.version"="${CHEMOTION_VERSION}"     "chemotion.internal.buildrun"="${BUILDRUN}"     "chemotion.internal.service.id"="eln"
 ---> Running in 5bceb5a2a4ce
Removing intermediate container 5bceb5a2a4ce
 ---> 949b64aa3347
Successfully built 949b64aa3347
Successfully tagged chemotion-build/eln:1.4.0
